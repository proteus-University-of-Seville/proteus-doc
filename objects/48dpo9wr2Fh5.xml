<?xml version='1.0' encoding='UTF-8'?>
<object id="48dpo9wr2Fh5" classes="paragraph" acceptedChildren=":Proteus-none" acceptedParents=":Proteus-any">
  <properties>
    <stringProperty name=":Proteus-name" category="general"><![CDATA[XSLT functions]]></stringProperty>
    <dateProperty name=":Proteus-date" category="general">2024-04-08</dateProperty>
    <floatProperty name="version" category="general">1.0</floatProperty>
    <markdownProperty name="text" category="details"><![CDATA[Registered XSLT functions are python functions that can be called from XSL stylesheets. These functions will always get XSL 'context' as their first argument. Example of XSLT function:

``` python
def image_to_base64(context, asset_file: List[ET._Element]) -> str:
    """
    Given an asset file path, return the base64 representation of the image.
    Build the absolute path using the current project path and the assets
    repository name.
    """

    assets_path: Path = StateManager().current_project_path / ASSETS_REPOSITORY / asset_file[0].text

    # Load the image using QImage
    image = QImage(assets_path.as_posix())

    ba = QByteArray()
    buffer = QBuffer(ba)
    buffer.open(QIODevice.OpenModeFlag.WriteOnly)
    image.save(buffer, 'PNG')
    base64_data = ba.toBase64().data().decode()
    return base64_data
```

Register the function using the `register_xslt_function` method:

```
def register(register_xslt_function, register_qwebchannel_class, _):
    register_xslt_function("image_to_base64", image_to_base64)
```

Using the XSLT function:

```
<xsl:variable name="image" select="proteus-utils:image_to_base64($file_name)"/>
```

In the `<xsl:stylesheet/>` declaration, `xmlns:proteus-utils="http://proteus.us.es/utils"` attribute must be added in order to use the `proteus-utils:` prefix.

```
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:proteus="http://proteus.us.es"
    xmlns:proteus-utils="http://proteus.us.es/utils"
    exclude-result-prefixes="proteus proteus-utils"
>
.
.
.
</xsl:stylesheet>

```]]></markdownProperty>
    <markdownProperty name="comments" category="comments"><![CDATA[]]></markdownProperty>
    <traceProperty name="created-by" category="general" acceptedTargets="stakeholder" traceType=":Proteus-author">
      <trace target="4Shtuic5WXUn" traceType=":Proteus-author"/>
    </traceProperty>
    <traceProperty name="dependencies" category="dependencies" acceptedTargets="general-traceable-object" traceType=":Proteus-dependency"/>
    <traceProperty name="source" category="dependencies" acceptedTargets="stakeholder" traceType=":Proteus-information-source"/>
  </properties>
  <children/>
</object>
